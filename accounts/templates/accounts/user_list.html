{% extends "base.html" %}

{% block content %}
<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center flex-wrap gap-2 mb-3">
    <h1 class="h4 m-0">Gestione utenti</h1>
  </div>

  {# =================== STAFF =================== #}
  <h2 class="h5 mt-4">Staff (Segretari e Gestori film)</h2>

  {% if staff_users %}
    <div class="table-responsive">
      <table class="table table-dark table-sm align-middle">
        <thead>
          <tr>
            <th>Username</th>
            <th>Email</th>
            <th>Telefono</th>
            <th>Gruppi</th>
          </tr>
        </thead>
        <tbody>
          {% for u in staff_users %}
            <tr>
              <td class="fw-semibold">{{ u.username }}</td>
              <td>{{ u.email }}</td>
              <td>{{ u.phone_number }}</td>
              <td>
                {% for g in u.groups.all %}
                  <span class="badge text-bg-light border">{{ g.name }}</span>
                {% endfor %}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <div class="alert alert-secondary">Nessun membro staff visibile.</div>
  {% endif %}

  {# =================== CLIENTI =================== #}
  <h2 class="h5 mt-4">Utenti comuni</h2>

  {% if client_users %}
    <div class="table-responsive">
      <table class="table table-dark table-sm align-middle">
        <thead>
          <tr>
            <th>Username</th>
            <th>Email</th>
            <th>Telefono</th>
            <th>Socio</th>
            <th class="text-end"></th>
          </tr>
        </thead>
        <tbody>
          {% for u in client_users %}
            <tr>
              <td class="fw-semibold">
                <a class="link-light text-decoration-none"
                   href="{% url 'accounts:user_prenotazioni' u.id %}">
                  {{ u.username }}
                </a>
              </td>
              <td>{{ u.email }}</td>
              <td>{{ u.phone_number }}</td>
              <td>
                {% if u.socio %}
                  <span class="badge text-bg-success">SÃ¬</span>
                {% else %}
                  <span class="badge text-bg-secondary">No</span>
                {% endif %}
              </td>
              <td class="text-end">
                <form method="post" action="{% url 'accounts:user_toggle_socio' u.id %}" class="d-inline">
                  {% csrf_token %}
                  {% if u.socio %}
                    <button type="submit" class="btn btn-outline-warning btn-sm">Revoca socio</button>
                  {% else %}
                    <button type="submit" class="btn btn-warning btn-sm">Rendi socio</button>
                  {% endif %}
                </form>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <div class="alert alert-info">Nessun utente comune trovato.</div>
  {% endif %}
</div>
{% endblock %}
